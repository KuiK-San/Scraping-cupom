<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Leitor de QR Code</title>
        <style>
            #video {
                width: 100%;
                max-width: 600px;
                margin: auto;
            }
        </style>
    </head>
    <body>
        <h1>Leitor de QR Code</h1>
        <label for="cameraList">Selecione a câmera:</label>
        <select id="cameraList"></select>
        <br />
        <video id="video" autoplay></video>
        <div class=""></div>

        <script src="https://cdn.rawgit.com/cozmo/jsQR/master/dist/jsQR.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Pega a referência do elemento de vídeo e da lista de câmeras
                const video = document.getElementById("videoElement");
                const cameraList = document.getElementById("cameraList");

                // Verifica se o navegador suporta a API de mídia
                if (
                    navigator.mediaDevices &&
                    navigator.mediaDevices.enumerateDevices
                ) {
                    // Lista todas as dispositivos de mídia (câmeras, microfones, etc.)
                    navigator.mediaDevices
                        .enumerateDevices()
                        .then((devices) => {
                            devices.forEach((device) => {
                                // Verifica se o dispositivo é uma câmera
                                if (device.kind === "videoinput") {
                                    // Adiciona a câmera à lista
                                    const option =
                                        document.createElement("option");
                                    option.value = device.deviceId;
                                    option.text =
                                        device.label ||
                                        `Câmera ${
                                            cameraList.options.length + 1
                                        }`;
                                    cameraList.appendChild(option);
                                }
                            });
                        })
                        .catch((err) => {
                            console.error(
                                "Erro ao listar dispositivos de mídia:",
                                err
                            );
                        });
                } else {
                    console.error(
                        "A API de mídia não é suportada neste navegador."
                    );
                }

                // Atualiza a fonte do vídeo quando o usuário seleciona uma câmera
                cameraList.addEventListener("change", function () {
                    const selectedCameraId = cameraList.value;
                    const constraints = {
                        video: { deviceId: { exact: selectedCameraId } },
                    };

                    // Usa a API de mídia para acessar a câmera selecionada
                    navigator.mediaDevices
                        .getUserMedia(constraints)
                        .then((stream) => {
                            video.srcObject = stream;
                        })
                        .catch((err) => {
                            console.error("Erro ao acessar a câmera:", err);
                        });
                });
            });
        </script>
        <script src="script.js"></script>
    </body>
</html>
